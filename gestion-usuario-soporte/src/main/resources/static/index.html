<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Login - Soporte</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container py-5">

    <h2>Iniciar Sesión</h2>
    <div class="mb-3">
        <label class="form-label">Correo</label>
        <input id="loginCorreo" class="form-control" placeholder="Correo electrónico">
    </div>
    <div class="mb-3">
        <label class="form-label">Contraseña</label>
        <input id="loginPass" class="form-control" type="password" placeholder="Contraseña">
    </div>
    <button class="btn btn-primary" onclick="login()">Iniciar sesión</button>

    <hr>

    <h2>Registro</h2>
    <div class="mb-3">
        <label class="form-label">Nombre</label>
        <input id="regNombre" class="form-control" placeholder="Nombre completo">
    </div>
    <div class="mb-3">
        <label class="form-label">Correo</label>
        <input id="regCorreo" class="form-control" placeholder="Correo electrónico">
    </div>
    <div class="mb-3">
        <label class="form-label">Contraseña</label>
        <input id="regPass" class="form-control" type="password" placeholder="Contraseña">
    </div>
    <button class="btn btn-success" onclick="registrar()">Registrar</button>

    <script>
        const API = "http://localhost:8081/api";

        // Si ya hay sesión activa, redirigir
        if (sessionStorage.getItem("usuarioId")) {
            window.location.href = "dashboard.html";
        }

        function registrar() {
    const nombre = document.getElementById("regNombre").value.trim();
    const correo = document.getElementById("regCorreo").value.trim();
    const contraseña = document.getElementById("regPass").value;

    if (!nombre || !correo || !contraseña) {
        return alert("Nombre, correo y contraseña son obligatorios");
    }

    fetch(`${API}/auth/registro`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ nombre, correo, contraseña })
    })
    .then(res => res.json().then(data => {
        if (!res.ok) throw new Error(data.mensaje || "Error desconocido");
        return data;
    }))
    .then(data => alert(data.mensaje || "Registro exitoso"))
    .catch(err => alert("Error al registrar usuario:\n" + err.message));
}
        function login() {
            const correo = document.getElementById("loginCorreo").value.trim();
            const contraseña = document.getElementById("loginPass").value;

            if (!correo || !contraseña) {
                return alert("Completa ambos campos para iniciar sesión");
            }

            fetch(`${API}/auth/login`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ correo, contraseña })
            })
            .then(res => {
                if (!res.ok) throw new Error("Credenciales incorrectas");
                return res.json();
            })
            .then(data => {
                alert(data.mensaje);
                sessionStorage.setItem("usuarioId", data.usuario.id);
                sessionStorage.setItem("usuarioNombre", data.usuario.nombre);
                sessionStorage.setItem("usuarioCorreo", data.usuario.correo);
                sessionStorage.setItem("usuarioRol", data.usuario.rol);
                window.location.href = "dashboard.html";
            })
            .catch(err => alert(err.message));
        }
    </script>
</body>
</html>
