<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gestión de Roles</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">
    <h2 class="mb-4">Gestión de Roles</h2>

    <div class="mb-3">
        <label for="nuevoRol" class="form-label">Nuevo Rol</label>
        <input type="text" class="form-control" id="nuevoRol" placeholder="Ej: ADMIN, ALUMNO, PROFESOR">
        <button class="btn btn-primary mt-2" onclick="crearRol()">Crear Rol</button>
    </div>

    <div id="mensaje" class="my-3"></div>

    <h4>Lista de Roles</h4>
    <ul class="list-group" id="listaRoles"></ul>

    <script>
        const API_URL = "http://localhost:8081/api/roles";

        window.onload = listarRoles;

        function mostrarMensaje(texto, tipo = "success") {
            const mensaje = document.getElementById("mensaje");
            mensaje.innerHTML = `<div class="alert alert-${tipo}">${texto}</div>`;
            setTimeout(() => mensaje.innerHTML = "", 3000);
        }

        function listarRoles() {
            fetch(API_URL)
                .then(response => response.json())
                .then(data => {
                    const lista = document.getElementById("listaRoles");
                    lista.innerHTML = "";
                    data.forEach(rol => {
                        const li = document.createElement("li");
                        li.className = "list-group-item d-flex justify-content-between align-items-center";
                        li.innerHTML = `
                            ${rol.nombre}
                            <button class="btn btn-danger btn-sm" onclick="eliminarRol(${rol.id})">Eliminar</button>
                        `;
                        lista.appendChild(li);
                    });
                })
                .catch(() => mostrarMensaje("Error al cargar los roles", "danger"));
        }

        function crearRol() {
            const nombre = document.getElementById("nuevoRol").value.trim();
            if (!nombre) {
                mostrarMensaje("Debes escribir un nombre de rol.", "warning");
                return;
            }

            fetch(API_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ nombre })
            })
            .then(res => res.json().then(data => ({ ok: res.ok, data })))
            .then(({ ok, data }) => {
                if (!ok) throw new Error(data.mensaje || "No se pudo crear el rol");
                document.getElementById("nuevoRol").value = "";
                mostrarMensaje("Rol creado exitosamente");
                listarRoles();
            })
            .catch(error => mostrarMensaje(error.message, "danger"));
        }

        function eliminarRol(id) {
            if (!confirm("¿Estás seguro de eliminar este rol?")) return;

            fetch(`${API_URL}/${id}`, { method: "DELETE" })
                .then(response => {
                    if (!response.ok) throw new Error("No se pudo eliminar el rol");
                    mostrarMensaje("Rol eliminado exitosamente");
                    listarRoles();
                })
                .catch(() => mostrarMensaje("Error al eliminar el rol", "danger"));
        }
    </script>
</body>
</html>
